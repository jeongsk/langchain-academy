<%*
// aiProvider 설정
// Note: AI Providers 플러그인에서 provider를 미리 설정해야 합니다
// AI Providers: <https://obsidian.md/plugins?id=ai-providers>
const PROVIDER_NAME = "ollama:gpt-oss"; // AI Providers 플러그인에서 설정한 provider 이름

// 제목 생성 프롬프트
const SYSTEM_PROMPT = "You are a title generator. You will give succinct titles that do not contain backslashes, forward slashes, or colons. Generate a title as your response. The title must capture the core idea of the main text. Technical terms are not translated, but used in their original form. Answer language is korean. max length is 85 character";

try {
 // 노트 내용 가져오기
 const fileContent = tp.file.content;

 // AI에게 제목 생성 요청 (aiProvider 사용)
 const provider = app.aiProviders.providers.find(e => e.name === PROVIDER_NAME);
 const messages = [
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user", content: `File content:\n${fileContent}` }
 ];
 const title = await app.aiProviders.execute({ provider, messages, onProgress: (_chunk, text) => text });
 console.log('Generated title:', title);

 // Obsidian의 normalizePath로 경로를 표준화하고 불필요한 문자를 제거
 const fileName = tp.obsidian.normalizePath(title.trim());
 console.log('Normalized fileName:', fileName);

 await tp.file.rename(fileName);
 new Notice(`✅ 제목이 "${fileName}"(으)로 변경되었습니다.`);
} catch(err) {
 console.error(err);
 new Notice(err?.message || err?.toString() || "제목 생성 중 에러가 발생했습니다.");
}
-%>
